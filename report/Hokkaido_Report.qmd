---
title: "Hokkaidō Island: Population, Climate, and Natural Disaster Patterns"
author: "Qiming Tian"
format: html
toc: true
number-sections: true
execute:
  echo: true
  warning: false
  message: false
---

```{r}
library(dplyr)
library(readr)
library(ggplot2)
library(sf)
library(leaflet)
library(lubridate)
source("../functions/cleaning.R")
```

# 1. Introduction

Hokkaidō is Japan's northernmost island and the second largest island in the country.
It is known for its unique climate, rapidly aging population, and frequent seismic activity.
The purpose of this report is to explore three important aspects of Hokkaidō:

- Long-term population changes  
- Climate trends, including warming patterns  
- Natural disaster risks, especially earthquakes  

This project integrates multiple datasets, performs data cleaning, and delivers statistical
summaries, maps, and visualizations to demonstrate modern data analysis and communication skills.

# 2. Data Sources and Cleaning

This project uses three major datasets:

1. Population data (1950–2023)  
2. Climate data (1950–2023, monthly)  
3. Earthquake records (2000–2023)  

```{r}
pop <- read_csv("../data/hokkaido_population.csv")
climate <- read_csv("../data/hokkaido_climate.csv")
eq <- read_csv("../data/earthquakes_japan.csv")

pop <- clean_pop(pop)
climate <- clean_climate(climate)
eq <- clean_eq(eq)
```

## 2.1 NA Evaluation

```{r}
summary(is.na(pop))
summary(is.na(climate))
summary(is.na(eq))
```

Population data are complete for all years.  
Climate data are complete for all months and years.  
Earthquake data are complete for latitude, longitude, and magnitude.

# 3. Population Trends in Hokkaidō

Hokkaidō's population has been declining for decades due to aging, low birth rates,
and out-migration to major cities like Tokyo.

```{r}
ggplot(pop, aes(year, population)) +
  geom_line() +
  labs(title = "Population of Hokkaidō (1950–2023)",
       x = "Year", y = "Population") +
  theme_minimal()
```

## 3.1 Aging Population

```{r}
ggplot(pop, aes(year, pct_over65)) +
  geom_line() +
  labs(title = "Percentage of Population Age 65+",
       x = "Year", y = "% Age 65+") +
  theme_minimal()
```

# 4. Climate Trends in Hokkaidō

Hokkaidō has experienced noticeable warming over the last 70 years.

```{r}
ggplot(climate, aes(year, mean_temp)) +
  geom_line() +
  geom_smooth(se = FALSE) +
  labs(title = "Average Temperature Trend in Hokkaidō",
       x = "Year", y = "Mean Temperature (°C)") +
  theme_minimal()
```

Seasonal variation is also clear:

```{r}
ggplot(climate, aes(factor(month), mean_temp)) +
  geom_boxplot() +
  labs(title = "Monthly Temperature Distribution",
       x = "Month", y = "Temperature (°C)") +
  theme_minimal()
```

# 5. Earthquake Activity

Hokkaidō frequently experiences earthquakes due to tectonic activity along Japan's subduction zones.

## 5.1 Earthquake Magnitude Distribution

```{r}
ggplot(eq, aes(mag)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribution of Earthquake Magnitudes",
       x = "Magnitude", y = "Count") +
  theme_minimal()
```

## 5.2 Earthquake Map

```{r}
library(sf)
hok <- sf::st_read("../data/hokkaido.geojson")
ggplot() +
  geom_sf(data = hok, fill = "white", color = "black") +
  geom_point(data = eq, aes(longitude, latitude, color = mag), alpha = 0.6) +
  scale_color_viridis_c() +
  labs(title = "Earthquake Epicenters in Hokkaido") +
  theme_minimal()
```

# 6. Statistical Model: Climate Warming Trend

We estimate the following model for annual average temperature:

$$
Temp_t = \beta_0 + \beta_1 t + \varepsilon_t
$$

where $Temp_t$ is the annual mean temperature and $t$ is the year.

```{r}
climate_annual <- climate |>
  group_by(year) |>
  summarise(mean_temp = mean(mean_temp, na.rm = TRUE))

lm_model <- lm(mean_temp ~ year, data = climate_annual)
summary(lm_model)
```

A positive slope coefficient indicates a long-term warming trend in Hokkaidō.

# 7. Summary

Key findings:

- Hokkaidō's population is steadily declining and aging rapidly.  
- Long-term warming is clear, especially over the last several decades.  
- Earthquake frequency remains high, with many magnitude 5+ events in recent years.  

This analysis provides a foundation for future policy, environmental planning,
and regional development studies.
